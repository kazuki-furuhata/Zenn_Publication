---
title: "「やりがち」を防ぐ！Looker環境整備で避けたいアンチパターン3選"
emoji: "🙅‍♂️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Looker", "BIツール", "googlecloud", "google", "データ分析"]
published: true
published_at: 2024-12-17 00:00 
publication_name: hogeticlab
---
# 1. はじめに

※ 本投稿は[Looker Advent Calendar 2024](https://qiita.com/advent-calendar/2024/looker)の17日目の記事となります

こんにちは、株式会社 Hogetic Lab の古畑です。
今回ご紹介するのは、Google が提供する BI ツール「**Looker**」に関する内容です。

Looker は、単なる BI ツールの枠を超えた強力な機能を備え、多くの企業で導入されています。
実際、[Looker Advent Calendar 2024](https://qiita.com/advent-calendar/2024/looker)や各社ブログでは、便利な Tips や最新機能に関する情報が数多く共有されています。

しかし、「最新の機能や Tips は分かるけれど、それを自社の環境にどう適用すれば良いのか分からない」という悩みを抱える方も少なくありません。
本記事では、Looker の運用コンサルティングを手掛ける私が、実際に目にした事例をもとに、Looker 環境整備や LookML 構築の際に陥りがちな**アンチパターン**を3つ取り上げ、解説します。

## 筆者経歴
- 文系学部卒。前職でビジネス職として入社後、データアナリストに転向
- 前職の業務で初めて Looker に触れ、現在は Looker のコンサルや実装を担当
- Looker の実装に関連する、Google Cloud 認定資格を複数個所持
    - Professional Data Engineer
    - Professional Machine Learning Engineer　など
- Looker 実装のアンチパターンをテーマに Google 主催のイベントで登壇経験あり
- [Google Cloud Partner Top Engineer 2025 受賞](https://zenn.dev/hogeticlab/articles/a2cf821a678d22)

# 2. アンチパターンその1: BigQueryに格納されている全てのテーブルをとりあえずViewにして格納する

## 概要
Looker導入時にありがちなミスのひとつが、BigQueryに格納されているすべてのテーブルを一律に View として LookML に格納してしまうことです。
一見、データを「完全に網羅」できて便利に思えるこの方法ですが、実際には多くの問題を引き起こします。

## なぜ陥りがちか
このアンチパターンに陥る背景には、以下のような要因があります。

- **スピード優先** : 導入初期に「とりあえず全部載せておけばいい」という発想になりがち。
- **データへの過信** : BigQuery のテーブル構造がそのまま Looker でも活用できると勘違い。
- **経験不足** : 最適なデータモデリング方法を知らないまま設定を進めてしまう。

## 具体例と影響
例えば、BigQueryに数百、数千単位のテーブルが存在する場合、それらをすべて View に格納すると以下のような問題が発生します。

1. **管理の複雑化**
不必要な View が大量に存在するため、LookML の構造が複雑になり、メンテナンスが困難になります。
特に、LookML の修正や削除が必要になったとき、調査の手間が増えてしまいます。

2. **パフォーマンス低下**
不要な View を作成することで、ダッシュボードの表示速度やクエリの実行速度が低下することがあります。
特に、冗長なクエリが生成されてしまう場合には影響が顕著です。

3. **ユーザの混乱**
データ探索を行うユーザーが膨大な View の中から目的のものを探すのは困難で、操作性が悪化します。
実際に社内からの反感を買ってしまい、データ活用が遅々として進まないケースもありました。

## 解決策
このアンチパターンを回避するには、以下のポイントを押さえましょう。

1. **必要なデータのみを選別する**
すべてのテーブルを View にするのではなく、利用頻度が高いものやビジネス上重要なデータだけを選定します。
これにより、シンプルかつ効率的なデータモデルを構築できます。

2. **集計テーブルやスキーマ設計を検討する**
BigQuery 側で事前に集計済みのテーブルを作成することで、Looker 側で余分な View を作成する必要がなくなります。
特に定期的なレポートで使用するデータは、事前集計が有効です。

# 3. アンチパターンその2: derived_tableに長大なSQLクエリを格納する

## 概要
LookML を用いて Looker 上にデータモデルを構築する際に、SQL クエリを直接記述できる **derived_table** を使うケースがあります。
この機能は大変便利ですが、「長大な SQL クエリ」をそのまま格納してしまうと、後々の運用に大きな支障をきたすことがあります。

## なぜ陥りがちか
このアンチパターンが発生する背景には、以下のような理由が挙げられます。

- **短期的な解決を優先** : 急いで結果を出したい場合に、一時的な対応として複雑な SQL をそのまま記述。
- **SQL に依存した思考** : Looker のデータモデリングの利点を活かさず、従来の SQL ベースの運用を引きずってしまう。
- **知識不足**: explore や view を組み合わせた Looker のベストプラクティスを知らない。

## 具体例と影響
複数のテーブルを結合し、さらに計算フィールドを追加するような例を考えてみましょう。
複雑な SQL クエリを derived_table に直接記述すると、次のような問題が発生します。

1. **メンテナンス性の低下**
長い SQL クエリは可読性が低く、後から変更や修正が必要になった場合に非常に手間がかかります。
特に、クエリ作成者以外が修正する場合には大きな障害となります。

2. **デバッグの困難さ**
クエリにエラーが生じた場合、その原因を特定するのが難しくなります。
また、部分的なテストが困難なため、開発プロセスの効率も低下します。

3. **パフォーマンスの問題**
derived_table に長大なクエリを記述すると、データベースに対する負荷が増大し、クエリの実行時間が長くなることがあります。
特に、Looker ダッシュボード上で複数ユーザーが同時にアクセスする場合、全体のパフォーマンスに悪影響を及ぼします。

## 解決策
このアンチパターンを回避するには、以下のポイントを押さえましょう。

1. **SQL クエリをモジュール化する**
長大なクエリを複数の view や explore に分割して管理します。
これにより、可読性が向上し、メンテナンスが容易になります。

2. **derived_table をシンプルに保つ**
本当に必要な場合にのみ derived_table を使用し、クエリはできる限り簡潔にすることを心掛けます。
また、ドキュメントを充実させることで、他のメンバーが理解しやすい状態を保つことが重要です。

# 4. アンチパターン3: Explore 内に大量の dimension ・ measure を詰め込む

## 概要
Looker の強力な機能のひとつである Explore は、データを自由に探索するための場として設計されています。
しかし、必要以上に多くの dimension や measure を Explore に詰め込むことで、逆にユーザー体験を損なう結果となることがあります。
この「何でも詰め込む」アプローチは、意図せずして非効率なデータ活用を招く原因になり得ます。

## なぜ陥りがちか
このアンチパターンが発生する背景には、以下のような理由が挙げられます。

- **データ網羅性への過剰な意識** : 「すべての項目を含めておけばユーザーに喜ばれるだろう」という考え。
- **事前整理の不足** : ユースケースを明確にせず、データ項目を無作為に追加してしまう。
- **初期段階の勢い** : Looker の Explore が「自由で柔軟」なツールであることを強調しすぎるあまり、ガイドラインを設けずに開発を進める。

## 具体例と影響
Explore 内に大量の dimension や measure を含めた場合、次のような問題が発生します。

1. **ユーザの混乱**
Explore に膨大な数の項目が表示されると、ユーザーは必要なデータを見つけるのに時間がかかり、混乱してしまいます。
これにより、データ探索のハードルが上がり、ツールの活用度が低下します。

2. **パフォーマンスの低下**
大量の項目が定義されている場合、クエリ生成プロセスが複雑化し、クエリの実行速度が低下することがあります。
特に高頻度で使用される Explore では、顕著な影響が出ます。

3. **運用コストの増加**
大量の項目を管理・更新することは、運用担当者にとって大きな負担となります。
定義内容を変更する際に、すべての項目を確認する必要が生じ、手戻りが増加するリスクがあります。

## 解決策
このアンチパターンを回避するには、以下のポイントを押さえましょう。

1. **必要な項目を明確にし、ユースケースごとに Explore を分割する**
ユーザーのニーズをヒアリングし、Explore に含めるべき最小限の dimension や measure を特定します。
ユーザーグループや業務ニーズごとに Explore を分割することで、それぞれの目的に特化した設計も実現できます。

2. **カテゴリ分けと名前付けの工夫**
項目を適切にグループ化し、わかりやすい名前を付けることで、ユーザーが目的のデータにすぐにアクセスできるようにします。
group_label やフォルダ機能を活用すると効果的です。

# 5. Looker環境整備を成功に導く3つのポイント
ここまで、Looker 環境整備や LookML 構築で陥りがちなアンチパターンを紹介しました。
それらを回避し、効果的に Looker を活用するためには、いくつかのポイントを押さえる必要があります。
本章では、Looker 環境整備を成功に導くための **3つのポイント** を解説します。

## ポイント1: 明確な目的を定義する
Looker 環境を設計する際には、まず「何を実現したいのか」を明確に定義することが重要です。

1. **ユーザーのニーズを把握する**
利用者がどのようなデータを使い、どのような意思決定を行いたいのかを具体的にヒアリングします。
これにより、不必要な項目や機能の追加を防ぎ、利用者の満足度が高い設計が可能になります。

2. **ユースケースごとに整理する**
売上分析、顧客行動のトラッキング、運用効率の可視化など、目的ごとに必要なデータモデルを構築しましょう。
ゴールを意識した設計が、運用の成功につながります。

## ポイント2: シンプルで拡張性のある設計を目指す
過度に複雑な設計は、運用の効率性やスケーラビリティを損ないます。シンプルさを保ちつつ、将来的な拡張を見据えた設計を行いましょう。

1. **Looker のベストプラクティスを採用する**
view や explore を適切に分割し、再利用可能なデータモデルを構築します。
また、頻繁に使用されるロジックは、SQL ではなく LookML の機能を活用して定義しましょう。

2. **適切なガイドラインを策定する**
LookML コードの命名規則やコメントの記述ルールを定め、チーム全体で共有します。
これにより、新しいメンバーがプロジェクトに参加した際のオンボーディングが容易になります。

## ポイント3: 運用と改善のサイクルを回す
設計・構築後も、運用中に得られるフィードバックをもとに継続的に改善を行うことが大切です。

1. **ユーザーの声を収集する仕組みを作る**
定期的にアンケートやインタビューを実施し、ユーザーが感じている課題や改善点を把握します。

2. **データの利用状況を分析する**
Looker の Usage パネルや監査ログを活用して、どの Explore やフィールドが実際に使用されているかを確認します。
使用されていない項目や冗長な定義は削除や整理を検討しましょう。

3. **新機能を積極的に取り入れる**
Google が提供する新機能や Looker のアップデート情報をフォローし、必要に応じて環境に取り入れることで、最新のデータ活用トレンドに対応します。

# 6. まとめ
Looker を使いこなすことは、単なるデータ可視化ツールの活用を超え、データドリブンな意思決定を組織に根付かせる大きな一歩です。
しかし、その潜在能力を最大限に引き出すためには、適切な設計と運用が不可欠です。

本記事では、Looker 環境整備や LookML 構築で陥りがちな3つのアンチパターンをご紹介しました。

1. **BigQueryの全テーブルをとりあえずViewに格納する**
2. **derived_tableに長大なSQLクエリを格納する**
3. **Explore内に大量のdimension・measureを格納しておく**

これらの問題を回避し、Looker 環境を成功に導くためのポイントとして、明確な目的の定義、シンプルで拡張性のある設計、運用と改善のサイクルを解説しました。

Looker はその柔軟性と機能の多さから、適切に設計・運用すればどのような企業のデータ活用ニーズにも応えることができます。
そして、Looker を使いこなすことで得られるメリットは、単なるレポート作成の効率化にとどまりません。
組織全体でのデータ民主化や、迅速かつ精度の高い意思決定を実現できる点にあります。

もしこの記事を読んで「自分の環境でもっとLookerを活用したい」と感じた方は、ぜひ一歩を踏み出してみてください。
まずはシンプルなモデルから始め、フィードバックをもとに改善を繰り返すことで、あなたの Looker 環境も着実に成長していきます。

最後に宣伝ですが、「どこから始めればいいのかわからない」「うちの環境に合わせたアドバイスが欲しい」といったお悩みがあれば、私たち Hogetic Lab にご相談ください。
Looker の導入から運用改善まで、データ活用を成功させるパートナーとして並走いたします。

また、データアナリストやデータエンジニアをはじめ、各ポジションでの採用も行っていますので、そちらもぜひご確認ください。

@[card](https://hogetic-lab.com/)
@[card](https://hogeticlab.notion.site/Hogetic-Lab-ae041841b7ac4cbcb1bffbc05c6b892e)

*さあ、Looker を活用して、データドリブンな未来を共に実現しましょう！*